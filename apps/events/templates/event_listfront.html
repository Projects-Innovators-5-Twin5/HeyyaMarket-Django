{% extends layout_path %}

{% load static %}
{% load i18n %}

{% block title %}Event List{% endblock %}

{% block content %}

<div class="container">
    <div class="row mb-4 text-center">
        <div class="col">
            <h2>ðŸŒŸ Heyya Events ðŸŒŸ</h2>
            <p>
                ðŸŽ‰ Welcome to the Event List! Discover exciting events happening around you! ðŸŽ‰<br>
                Use the search bar below to find specific events or filter by status to see what's currently available.
            </p>
            <!-- Improved Calendar Button Placement -->
            <div class="mt-3 mb-5">
                <a href="{% url 'calendar_view' %}" class="btn btn-secondary btn-lg">
                    <i class="ri-calendar-line me-1"></i> See Calendar
                </a>
            </div>
        </div>
    </div>
    <div class="row mb-4 justify-content-center">
        <div class="col-md-8">

    <form class="navbar-search form-inline" id="navbar-search-main">
        <div class="input-group input-group-merge search-bar">
            <input type="text" id="search-input" name="q" class="form-control" placeholder="Search events..." value="{{ request.GET.q }}" style="width: 80%;">
            
            <!-- Add the status filter dropdown nested within the input group -->
            <select id="status-filter" name="status" class="form-select" style="width: 20%;">
                <option value="">All</option>
                <option value="scheduled" {% if request.GET.status == 'scheduled' %}selected{% endif %}>Scheduled</option>
                <option value="finished" {% if request.GET.status == 'finished' %}selected{% endif %}>Finished</option>
                <option value="cancelled" {% if request.GET.status == 'cancelled' %}selected{% endif %}>Cancelled</option>
            </select>
        </div>
    </form>
</div>
</div>

        
        <!-- Dynamic event list rendering -->
        <div id="event-list" class="row mb-12 g-6">
            {% include 'event_listfront_partial.html' %}
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        // Function to fetch events based on input and dropdown values
        function fetchEvents() {
            let query = $('#search-input').val();
            let status = $('#status-filter').val();
            $.ajax({
                url: '{% url "event_listfront" %}',
                data: {
                    'q': query,
                    'status': status
                },
                success: function(data) {
                    $('#event-list').html(data);
                },
                error: function(xhr, status, error) {
                    console.error('AJAX Error: ' + status + ' - ' + error);
                }
            });
        }

        // Live search input listener
        $('#search-input').on('input', function() {
            fetchEvents();
        });

        // Live status filter listener
        $('#status-filter').on('change', function() {
            fetchEvents();
        });
    });
</script>

{% endblock %}
